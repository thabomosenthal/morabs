name: CI (Quality & Safety)

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  verify:
    runs-on: ubuntu-latest
    timeout-minutes: 10 # Keeps your free minutes safe

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10 # Matches your local pnpm v10

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "pnpm"

      - name: Install Dependencies
        run: pnpm install --frozen-lockfile

      - name: Biome (Lint & Format)
        run: pnpm biome ci .

      - name: Next.js Safety (ESLint)
        # This uses the minimal config we set up to catch
        # Next-specific issues like <img /> vs <Image />
        run: pnpm run lint:next

      - name: Production Build Check
        # Important: Catches TypeScript errors that only show
        # up when the whole app is compiled.
        run: pnpm build
